import { Router } from 'express';
import inventoryController from '../controllers/inventoryController';
import { authenticate } from '../middleware/auth';
import { canManageInventory } from '../middleware/roleCheck';
import { handleValidation } from '../middleware/validation';
import { inventoryValidators } from '../utils/validators';

const router = Router();

router.use(authenticate);

// IMPORTANT: Suppliers routes MUST come BEFORE /:id routes
// Suppliers
router.get('/suppliers', inventoryController.getSuppliers);
router.post('/suppliers', canManageInventory, inventoryValidators.createSupplier, handleValidation, inventoryController.createSupplier);
router.put('/suppliers/:id', canManageInventory, inventoryValidators.updateSupplier, handleValidation, inventoryController.updateSupplier);

// Inventory items - specific routes before parameterized routes
router.get('/low-stock', inventoryController.getLowStockItems);
router.get('/value-summary', inventoryController.getValueSummary);
router.post('/transaction', canManageInventory, inventoryValidators.stockTransaction, handleValidation, inventoryController.recordTransaction);

// Inventory items - general routes
router.get('/', inventoryController.getItems);
router.post('/', canManageInventory, inventoryValidators.createItem, handleValidation, inventoryController.createItem);

// Inventory items - parameterized routes (MUST BE LAST)
router.get('/:id', inventoryController.getItem);
router.get('/:id/transactions', inventoryController.getItemTransactions);
router.put('/:id', canManageInventory, inventoryController.updateItem);

export default router;
